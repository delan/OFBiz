<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE site-conf PUBLIC "-//OFBiz//DTD Request Config//EN" "http://www.ofbiz.org/dtds/site-conf.dtd">

<site-conf>
    <description>OFBiz: eCommerce Controller Configuration File</description>
    <owner>The Open For Business Project Copyright (c) 2001</owner>
    <errorpage>/error/error.jsp</errorpage>

    <handler name="java" type="request" class="org.ofbiz.core.event.JavaEventHandler"/>
    <handler name="soap" type="request" class="org.ofbiz.core.event.SOAPEventHandler"/>
    <handler name="service" type="request" class="org.ofbiz.core.event.ServiceEventHandler"/>
    <handler name="simple" type="request" class="org.ofbiz.core.event.SimpleEventHandler"/>

    <handler name="region" type="view" class="org.ofbiz.core.view.RegionViewHandler"/>
    <handler name="velocity" type="view" class="org.ofbiz.core.view.VelocityViewHandler"/>
    <handler name="http" type="view" class="org.ofbiz.core.view.HttpViewHandler"/>

    <!-- Events run from here for the first hit in a visit -->
    <firstvisit>
        <event type="java" path="org.ofbiz.commonapp.security.login.LoginEvents" invoke="autoLoginCheck"/>
        <event type="java" path="org.ofbiz.commonapp.marketing.tracking.TrackingCodeEvents" invoke="checkTrackingCodeCookies"/>
    </firstvisit>
    
    <!-- Events to run on every request before security (chains exempt) -->
    <preprocessor>
        <!-- This event allows affilate/distributor entry on any page -->
        <event type="java" path="org.ofbiz.ecommerce.misc.ThirdPartyEvents" invoke="setAssociationId"/>
        <event type="java" path="org.ofbiz.commonapp.marketing.tracking.TrackingCodeEvents" invoke="checkTrackingCodeUrlParam"/>
    </preprocessor>

    <!-- Events to run on every request after all other processing (chains exempt) -->
    <!--
    <postprocessor>
        <event type="java" path="org.ofbiz.core.event.TestEvent" invoke="test"/>
    </postprocessor>
    -->

    <!-- Security Mappings -->
    <request-map uri="checkLogin" edit="false">
        <description>Verify a user is logged in.</description>
        <security https="false" auth="false"/>
        <event type="java" path="org.ofbiz.commonapp.security.login.LoginEvents" invoke="checkLogin" />
        <response name="success" type="view" value="name" />
        <response name="error" type="view" value="login" />
    </request-map>

    <request-map uri="login">
        <security https="true" auth="false"/>
        <event type="java" path="org.ofbiz.commonapp.security.login.LoginEvents" invoke="login"/>
        <response name="success" type="request" value="updatedistributor"/>
        <response name="error" type="view" value="login"/>
    </request-map>

    <request-map uri="logout">
        <security https="true" auth="true"/>
        <event type="java" path="org.ofbiz.commonapp.security.login.LoginEvents" invoke="logout"/>
        <response name="success" type="view" value="main"/>
        <response name="error" type="view" value="main"/>
    </request-map>

    <request-map uri="autoLogout">
        <event type="java" path="org.ofbiz.commonapp.security.login.LoginEvents" invoke="autoLoginRemove"/>
        <response name="success" type="view" value="main"/>
        <response name="error" type="view" value="main"/>
    </request-map>
    <!-- End of Security Mappings -->

    <!-- Request Mappings -->
    <request-map uri="setdistributor">
        <security https="true" auth="false"/>
        <event type="java" path="org.ofbiz.ecommerce.misc.ThirdPartyEvents" invoke="setAssociationId"/>
        <response name="success" type="view" value="main"/>
        <response name="error" type="view" value="main"/>
    </request-map>

    <request-map uri="updatedistributor">
        <security https="true" auth="false"/>
        <event type="java" path="org.ofbiz.ecommerce.misc.ThirdPartyEvents" invoke="updateAssociatedDistributor"/>
        <response name="success" type="view" value="main"/>
        <response name="error" type="view" value="main"/>
    </request-map>

    <request-map uri="view">
        <response name="success" type="view" value="main"/>
        <response name="error" type="view" value="error"/>
    </request-map>

    <request-map uri="authview">
        <security https="true" auth="true"/>
        <response name="success" type="view" value="main"/>
        <response name="error" type="view" value="error"/>
    </request-map>

    <request-map uri="main">
        <response name="success" type="view" value="main"/>
    </request-map>

    <request-map uri="passwordemail">
        <response name="success" type="view" value="passwordemail"/>
    </request-map>

    <request-map uri="additem">
        <event type="java" path="org.ofbiz.commonapp.order.shoppingcart.ShoppingCartEvents" invoke="addToCart"/>
        <response name="success" type="view" value="showcart"/>
        <response name="error" type="view" value="showcart"/>
    </request-map>

    <request-map uri="addordertocart">
        <security https="true" auth="true"/>
        <event type="java" path="org.ofbiz.commonapp.order.shoppingcart.ShoppingCartEvents" invoke="addToCartFromOrder"/>
        <response name="success" type="view" value="showcart"/>
        <response name="error" type="view" value="orderstatus"/>
    </request-map>

    <request-map uri="addtocartbulk">
        <event type="java" path="org.ofbiz.commonapp.order.shoppingcart.ShoppingCartEvents" invoke="addToCartBulk"/>
        <response name="success" type="view" value="quickadd"/>
        <response name="error" type="view" value="quickadd"/>
    </request-map>
    <request-map uri="addCategoryDefaults">
        <event type="java" path="org.ofbiz.commonapp.order.shoppingcart.ShoppingCartEvents" invoke="addCategoryDefaults"/>
        <response name="success" type="view" value="showcart"/>
        <response name="error" type="view" value="showcart"/>
    </request-map>

    <request-map uri="addseperator">
        <event type="java" path="org.ofbiz.commonapp.order.shoppingcart.ShoppingCartEvents" invoke="addSeparator"/>
        <response name="success" type="view" value="showcart"/>
        <response name="error" type="view" value="showcart"/>
    </request-map>

    <request-map uri="modifycart">
        <event type="java" path="org.ofbiz.commonapp.order.shoppingcart.ShoppingCartEvents" invoke="modifyCart"/>
        <response name="success" type="view" value="showcart"/>
        <response name="error" type="view" value="showcart"/>
    </request-map>

    <request-map uri="emptycart">
        <event type="java" path="org.ofbiz.commonapp.order.shoppingcart.ShoppingCartEvents" invoke="clearCart"/>
        <response name="success" type="view" value="showcart"/>
        <response name="error" type="view" value="showcart"/>
    </request-map>

    <request-map uri="checkoutoptions">
        <security https="true" auth="true"/>
        <event type="java" path="org.ofbiz.commonapp.order.shoppingcart.CheckOutEvents" invoke="cartNotEmpty"/>
        <response name="success" type="view" value="checkoutoptions"/>
        <response name="error" type="view" value="main"/>
    </request-map>

    <request-map uri="checkout">
      <security https="true" auth="true"/>
	  <event type="java" path="org.ofbiz.commonapp.order.shoppingcart.CheckOutEvents" invoke="cartNotEmpty"/>
      <response name="success" type="request" value="setOptions"/>
	  <response name="error" type="view" value="showcart"/>
    </request-map>

	<request-map uri="setOptions">
      <security https="true" auth="true"/>
	  <event type="java" path="org.ofbiz.commonapp.order.shoppingcart.CheckOutEvents" invoke="setCheckOutOptions"/>
	  <response name="success" type="request" value="calcShipping"/>
	  <response name="error" type="view" value="checkoutoptions"/>
	</request-map>

    <request-map uri="calcShipping">
        <security https="true" auth="true"/>
        <event type="java" path="org.ofbiz.commonapp.shipment.shipment.ShippingEvents" invoke="getShipEstimate"/>
        <response name="success" type="request" value="calcTax"/>
        <response name="error" type="view" value="checkoutoptions"/>
    </request-map>

    <request-map uri="calcTax">
        <security https="true" auth="true"/>
        <event type="java" path="org.ofbiz.commonapp.order.shoppingcart.CheckOutEvents" invoke="calcTax"/>
        <response name="success" type="view" value="checkout"/>
        <response name="error" type="view" value="checkoutoptions"/>
    </request-map>

    <request-map uri="checkBlacklist">
        <security direct-request="false"/>
        <event type="java" path="org.ofbiz.commonapp.order.shoppingcart.CheckOutEvents" invoke="checkOrderBlacklist"/>
        <response name="success" type="request" value="processpayment"/>
        <response name="failed" type="request" value="failedBlacklist"/>
        <response name="error" type="view" value="checkout"/>
    </request-map>
    
    <request-map uri="failedBlacklist">
        <security direct-request="false"/>
        <event type="java" path="org.ofbiz.commonapp.order.shoppingcart.CheckOutEvents" invoke="failedBlacklistCheck"/>
        <response name="success" type="view" value="main"/>       
        <response name="error" type="view" value="error"/>
    </request-map>    

    <request-map uri="processorder">
        <security https="true" auth="true"/>
        <event type="java" path="org.ofbiz.commonapp.order.shoppingcart.CheckOutEvents" invoke="createOrder"/>
        <response name="success" type="request" value="checkBlacklist"/>
        <response name="error" type="view" value="checkout"/>
    </request-map>

    <request-map uri="processpayment">
        <security direct-request="false"/>
        <event type="java" path="org.ofbiz.commonapp.order.shoppingcart.CheckOutEvents" invoke="processPayment"/>
        <response name="success" type="request" value="clearcart"/>
        <response name="fail" type="view" value="checkoutoptions"/>
        <response name="error" type="view" value="checkout"/>
    </request-map>

    <request-map uri="clearcart">
        <security https="true" auth="true"/>
        <event type="java" path="org.ofbiz.commonapp.order.shoppingcart.ShoppingCartEvents" invoke="clearCart"/>
        <response name="success" type="request" value="renderconfirmorder"/>
        <response name="error" type="view" value="checkout"/>
    </request-map>

    <request-map uri="renderconfirmorder">
        <security https="true" auth="true"/>
        <event type="java" path="org.ofbiz.commonapp.order.shoppingcart.CheckOutEvents" invoke="renderConfirmOrder"/>
        <response name="success" type="request" value="emailorder"/>
        <response name="error" type="view" value="orderhistory"/>
    </request-map>

    <request-map uri="emailorder">
        <security https="true" auth="true"/>
        <event type="java" path="org.ofbiz.commonapp.order.shoppingcart.CheckOutEvents" invoke="emailOrder"/>
        <response name="success" type="view" value="showconfirmorder"/>
        <response name="error" type="view" value="showconfirmorder"/>
    </request-map>

    <request-map uri="confirmorder">
        <response name="success" type="view" value="confirmorder"/>
    </request-map>

    <request-map uri="catalog">
        <response name="success" type="view" value="catalog"/>
    </request-map>

    <request-map uri="quickadd">
        <response name="success" type="view" value="quickadd"/>
    </request-map>

    <request-map uri="category">
        <response name="success" type="view" value="category"/>
    </request-map>

    <request-map uri="product">
        <response name="success" type="view" value="product"/>
    </request-map>

    <request-map uri="keywordsearch">
        <response name="success" type="view" value="keywordsearch"/>
    </request-map>

    <request-map uri="orderhistory">
        <security https="true" auth="true"/>
        <response name="success" type="view" value="orderhistory"/>
    </request-map>

    <request-map uri="orderstatus">
        <security https="true" auth="true"/>
        <response name="success" type="view" value="orderstatus"/>
    </request-map>

    <request-map uri="newcustomer">
        <security https="true" auth="false"/>
        <response name="success" type="view" value="newcustomer"/>
    </request-map>

    <request-map uri="createcustomer">
        <security https="true" auth="false"/>
        <event type="simple" path="org/ofbiz/ecommerce/customer/CustomerEvents.xml" invoke="createCustomer"/>
        <response name="success" type="request" value="updatedistributor"/>
        <response name="error" type="view" value="newcustomer"/>
    </request-map>

    <request-map uri="viewprofile">
        <security https="true" auth="true"/>
        <response name="success" type="view" value="viewprofile"/>
    </request-map>

    <request-map uri="editcontactmech">
        <security https="true" auth="true"/>
        <response name="success" type="view" value="editcontactmech"/>
    </request-map>

    <request-map uri="createContactMech">
        <security https="true" auth="true"/>
        <event type="simple" path="org/ofbiz/commonapp/party/contact/ContactMechSimpleEvents.xml" invoke="createContactMech"/>
        <response name="success" type="view" value="editcontactmech"/>
        <response name="error" type="view" value="editcontactmech"/>
    </request-map>

    <request-map uri="updateContactMech">
        <security https="true" auth="true"/>
        <event type="simple" path="org/ofbiz/commonapp/party/contact/ContactMechSimpleEvents.xml" invoke="updateContactMech"/>
        <response name="success" type="view" value="editcontactmech"/>
        <response name="error" type="view" value="editcontactmech"/>
    </request-map>

    <request-map uri="deleteContactMech">
        <security https="true" auth="true"/>
        <event type="simple" path="org/ofbiz/commonapp/party/contact/ContactMechSimpleEvents.xml" invoke="deleteContactMech"/>
        <response name="success" type="view" value="editcontactmech"/>
        <response name="error" type="view" value="editcontactmech"/>
    </request-map>

    <request-map uri="createPostalAddressAndPurpose">
        <security https="true" auth="true"/>
        <event type="simple" path="org/ofbiz/commonapp/party/contact/ContactMechSimpleEvents.xml" invoke="createPostalAddressAndPurpose"/>
        <response name="success" type="view" value="editcontactmech"/>
        <response name="error" type="view" value="editcontactmech"/>
    </request-map>

    <request-map uri="createPostalAddress">
        <security https="true" auth="true"/>
        <event type="simple" path="org/ofbiz/commonapp/party/contact/ContactMechSimpleEvents.xml" invoke="createPostalAddress"/>
        <response name="success" type="view" value="editcontactmech"/>
        <response name="error" type="view" value="editcontactmech"/>
    </request-map>

    <request-map uri="updatePostalAddress">
        <security https="true" auth="true"/>
        <event type="simple" path="org/ofbiz/commonapp/party/contact/ContactMechSimpleEvents.xml" invoke="updatePostalAddress"/>
        <response name="success" type="view" value="editcontactmech"/>
        <response name="error" type="view" value="editcontactmech"/>
    </request-map>

    <request-map uri="createTelecomNumber">
        <security https="true" auth="true"/>
        <event type="simple" path="org/ofbiz/commonapp/party/contact/ContactMechSimpleEvents.xml" invoke="createTelecomNumber"/>
        <response name="success" type="view" value="editcontactmech"/>
        <response name="error" type="view" value="editcontactmech"/>
    </request-map>

    <request-map uri="updateTelecomNumber">
        <security https="true" auth="true"/>
        <event type="simple" path="org/ofbiz/commonapp/party/contact/ContactMechSimpleEvents.xml" invoke="updateTelecomNumber"/>
        <response name="success" type="view" value="editcontactmech"/>
        <response name="error" type="view" value="editcontactmech"/>
    </request-map>

    <request-map uri="createEmailAddress">
        <security https="true" auth="true"/>
        <event type="simple" path="org/ofbiz/commonapp/party/contact/ContactMechSimpleEvents.xml" invoke="createEmailAddress"/>
        <response name="success" type="view" value="editcontactmech"/>
        <response name="error" type="view" value="editcontactmech"/>
    </request-map>

    <request-map uri="updateEmailAddress">
        <security https="true" auth="true"/>
        <event type="simple" path="org/ofbiz/commonapp/party/contact/ContactMechSimpleEvents.xml" invoke="updateEmailAddress"/>
        <response name="success" type="view" value="editcontactmech"/>
        <response name="error" type="view" value="editcontactmech"/>
    </request-map>

    <request-map uri="createPartyContactMechPurpose">
        <security https="true" auth="true"/>
        <event type="simple" path="org/ofbiz/commonapp/party/contact/ContactMechSimpleEvents.xml" invoke="createPartyContactMechPurpose"/>
        <response name="success" type="view" value="editcontactmech"/>
        <response name="error" type="view" value="editcontactmech"/>
    </request-map>

    <request-map uri="deletePartyContactMechPurpose">
        <security https="true" auth="true"/>
        <event type="simple" path="org/ofbiz/commonapp/party/contact/ContactMechSimpleEvents.xml" invoke="deletePartyContactMechPurpose"/>
        <response name="success" type="view" value="editcontactmech"/>
        <response name="error" type="view" value="editcontactmech"/>
    </request-map>

    <request-map uri="editcreditcard">
        <security https="true" auth="true"/>
        <response name="success" type="view" value="editcreditcard"/>
    </request-map>
    <request-map uri="createCreditCard">
        <security https="true" auth="true"/>
        <event type="simple" path="org/ofbiz/commonapp/accounting/payment/PaymentSimpleMethods.xml" invoke="createCreditCard"/>
        <response name="success" type="view" value="editcreditcard"/>
        <response name="address" type="view" value="editcontactmech"/>
        <response name="error" type="view" value="editcreditcard"/>
    </request-map>
    <request-map uri="updateCreditCard">
        <security https="true" auth="true"/>
        <event type="simple" path="org/ofbiz/commonapp/accounting/payment/PaymentSimpleMethods.xml" invoke="updateCreditCard"/>
        <response name="success" type="view" value="editcreditcard"/>
        <response name="address" type="view" value="editcontactmech"/>
        <response name="error" type="view" value="editcreditcard"/>
    </request-map>

    <request-map uri="editeftaccount">
        <security https="true" auth="true"/>
        <response name="success" type="view" value="editeftaccount"/>
    </request-map>
    <request-map uri="createEftAccount">
        <security https="true" auth="true"/>
        <event type="simple" path="org/ofbiz/commonapp/accounting/payment/PaymentSimpleMethods.xml" invoke="createEftAccount"/>
        <response name="success" type="view" value="editeftaccount"/>
        <response name="error" type="view" value="editeftaccount"/>
    </request-map>
    <request-map uri="updateEftAccount">
        <security https="true" auth="true"/>
        <event type="simple" path="org/ofbiz/commonapp/accounting/payment/PaymentSimpleMethods.xml" invoke="updateEftAccount"/>
        <response name="success" type="view" value="editeftaccount"/>
        <response name="error" type="view" value="editeftaccount"/>
    </request-map>

    <request-map uri="deletePaymentMethod">
        <security https="true" auth="true"/>
        <event type="simple" path="org/ofbiz/commonapp/accounting/payment/PaymentSimpleMethods.xml" invoke="deletePaymentMethod"/>
        <response name="success" type="view" value="viewprofile"/>
        <response name="error" type="view" value="viewprofile"/>
    </request-map>

    <request-map uri="editperson">
        <security https="true" auth="true"/>
        <response name="success" type="view" value="editperson"/>
    </request-map>

    <request-map uri="createPerson">
        <security https="true" auth="true"/>
        <event type="simple" path="org/ofbiz/commonapp/party/party/PartySimpleEvents.xml" invoke="createPerson"/>
        <response name="success" type="view" value="editperson"/>
        <response name="error" type="view" value="editperson"/>
    </request-map>

    <request-map uri="updatePerson">
        <security https="true" auth="true"/>
        <event type="simple" path="org/ofbiz/commonapp/party/party/PartySimpleEvents.xml" invoke="updatePerson"/>
        <response name="success" type="view" value="editperson"/>
        <response name="error" type="view" value="editperson"/>
    </request-map>

    <request-map uri="changepassword">
        <security https="true" auth="true"/>
        <response name="success" type="view" value="changepassword"/>
    </request-map>

    <request-map uri="updatePassword">
        <security https="true" auth="true"/>
        <event type="simple" path="org/ofbiz/commonapp/security/login/LoginSimpleEvents.xml" invoke="updatePassword"/>
        <response name="success" type="view" value="changepassword"/>
        <response name="error" type="view" value="changepassword"/>
    </request-map>

    <request-map uri="forgotpassword">
        <security https="true" auth="false"/>
        <event type="java" path="org.ofbiz.commonapp.security.login.LoginEvents" invoke="forgotPassword"/>
        <response name="success" type="view" value="login"/>
        <response name="error" type="view" value="login"/>
    </request-map>

    <request-map uri="changeDelegator">
        <event type="java" path="org.ofbiz.core.event.CoreEvents" invoke="changeDelegator"/>
        <response name="success" type="view" value="main"/>
        <response name="error" type="view" value="error"/>
    </request-map>

    <request-map uri="newAffiliate">
        <response name="success" type="view" value="newAffiliate"/>
    </request-map>

    <request-map uri="createAffiliate">
        <event type="simple" path="org/ofbiz/ecommerce/misc/AffiliateSimpleEvents.xml" invoke="createAffiliate"/>
        <response name="success" type="view" value="newAffiliate"/>
        <response name="success" type="view" value="newAffiliate"/>
    </request-map>
    <!-- End of Request Mappings -->

    <!-- View Mappings -->
    <view-map name="error" page="/error/error.jsp"/>
    <view-map name="main" type="region"/>
    <view-map name="login" type="region"/>
    <view-map name="passwordemail" page="/customer/passwordemail.jsp"/>

    <view-map name="showcart" type="region"/>

    <view-map name="quickadd" type="region"/>
    <view-map name="category" type="region"/>
    <view-map name="product" type="region"/>
    <view-map name="keywordsearch" type="region"/>

    <view-map name="checkoutoptions" type="region"/>
    <view-map name="checkout" type="region"/>
    <view-map name="confirmorder" page="/order/confirmorder.jsp"/>
    <view-map name="showconfirmorder" type="region"/>
    <view-map name="orderhistory" type="region"/>
    <view-map name="orderstatus" type="region"/>

    <view-map name="viewprofile" type="region"/>
    <view-map name="newcustomer" type="region"/>
    <view-map name="editcontactmech" type="region"/>
    <view-map name="editcreditcard" type="region"/>
    <view-map name="editeftaccount" type="region"/>
    <view-map name="changepassword" type="region"/>
    <view-map name="editperson" type="region"/>

    <view-map name="newAffiliate" type="region"/>
    <!-- End of View Mappings -->
</site-conf>
