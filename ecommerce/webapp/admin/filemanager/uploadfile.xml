<?xml version="1.0"?>

<page xmlns="http://www.einnovation.com/xmlns/WSP/Admin/Content"
    xmlns:html="http://www.w3.org/1999/xhtml" onload="window.focus()">
  <title>Upload a File</title>
  <content>
	## Strip the filename off the path.  We don't seem to have access to PathUtilities in here.
	#set ( $editingPath = $request.getParameter( 'editingPath' ) )
	#set ( $slashPos = $editingPath.lastIndexOf( '/' ) )
	#if ( $slashPos > 0 )
		#set( $basePath = $editingPath.substring( 0, $slashPos ) )
		#set( $prefix = $basePath )
	#else
		#set( $basePath = "/" )
		#set( $prefix = "" )
	#end
	
	## Determine which upload screen to show.
	
    #set ( $adminModule = $site.getModule( 'admin' ) )
    #if ( $adminModule && $adminModule.rootFTPURL && $browser.nickName == 'MSIE' && $user && $user.hasPermission( 'wsp.edit.ftpUpload' ) )
      ## Show the FTP upload screen.
      <dialog fill="yes">
      	<title>Upload File</title>
      	<content>
          <box>
            Please drag the files you wish to upload into the box below.  Do not
            delete any files from this box, however, because the changes will not be
            reflected in any version control system you may have configured.
            <html:hr/>
            <html:iframe src="$adminModule.rootFTPURL$basePath" width="100%" height="200"/>
          </box>
      	</content>
      	<buttons>
      	  <button name="Close" onclick="window.close()"/>
      	</buttons>
      </dialog>
    #else
      ## Show the normal (non-FTP-based) upload screen.
      <dialog enctype="multipart/form-data" fill="yes">
      	<title>Upload File</title>
        <content>
          <divided-box>
            <item>
              <header>File to upload:</header>
              <detail><html:input type="file" size="40" name="file"/></detail>
            </item>
            <item>
              <header>"Save As" path including filename:</header>
              <detail><html:input type="text" name="path" size="40" value="$prefix/newfile.html" /></detail>
            </item>
          </divided-box>
        </content>
        <buttons>
          <html:input name="basePath" type="hidden" value="$basePath" />
          <submit-button name="OK" href="uploadfile-finish.html?editingPath=$url_util.encode($editingPath)"/>
          <cancel onclick="window.close()"/>
        </buttons>
      </dialog>
    #end
  </content>
</page>
