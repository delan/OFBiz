<?xml version="1.0" encoding="ISO-8859-1"?>
<simple-methods>
    <simple-method login-required="false" method-name="createContentAndPurpose">
        <make-value entity-name="Content" value-name="currentContent"/>
        <set-pk-fields map-name="parameters" value-name="currentContent"/>
        <set-nonpk-fields map-name="parameters" value-name="currentContent"/>
        <if-empty field-name="contentId" map-name="currentContent">
            <make-next-seq-id seq-field-name="contentId" value-name="currentContent"/>
            <sequenced-id-to-env env-name="id" sequence-name="Content"/>
            <env-to-field env-name="id" field-name="contentId" map-name="currentContent"/>
        </if-empty>
        <log level="always" message="currentContent: ${currentContent}"/>
        <field-to-list field-name="contentPurposeTypeId"
            list-name="contentPurposeList" map-name="parameters"/>
        <string-to-list list-name="targetOperationList" string="CONTENT_CREATE"/>
        <field-to-field field-name="currentContent" to-map-name="context"/>
        <field-to-field field-name="contentPurposeList" to-map-name="context"/>
        <field-to-field field-name="targetOperationList" to-map-name="context"/>
        <field-to-field field-name="currentContent" to-map-name="context"/>
        <session-to-field field-name="userLogin" map-name="context" session-name="userLogin"/>
        <call-service in-map-name="context" service-name="checkContentPermission">
            <result-to-field field-name="permissionStatus" result-name="permissionStatus"/>
        </call-service>
        <log level="always" message="permissionStatus:${permissionStatus}"/>
        <if-compare field-name="permissionStatus" operator="not-equals"
            type="String" value="granted">
            <add-error>
                <fail-message message="Permission not granted."/>
            </add-error>
        </if-compare>
        <check-errors/>
        <if-compare field-name="permissionStatus" operator="equals"
            type="String" value="granted">
            <create-value value-name="currentContent"/>
            <if-not-empty field-name="contentPurposeTypeId" map-name="parameters">
                <make-value entity-name="ContentPurpose" value-name="newContentPurpose"/>
                <field-to-field field-name="contentPurposeTypeId"
                    map-name="parameters" to-map-name="newContentPurpose"/>
                <field-to-field field-name="contentId" map-name="currentContent" to-map-name="newContentPurpose"/>
                <create-value value-name="newContentPurpose"/>
            </if-not-empty>
        </if-compare>
    </simple-method>
</simple-methods>
