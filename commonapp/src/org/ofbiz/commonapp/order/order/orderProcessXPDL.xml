<?xml version="1.0"?>
<!DOCTYPE Package PUBLIC "-//OFBiz//XPDL Definition//EN" "http://www.ofbiz.org/dtds/xpdl.dtd">

<Package Id="org.ofbiz.commonapp.order.order">
    <PackageHeader>
        <XPDLVersion>0.03</XPDLVersion>
        <Vendor>OFBiz.org</Vendor>
        <Created>2002-12-03 00:00:00</Created>
        <Description>Demo Order Processing Workflow</Description>
        <Documentation>None</Documentation>
        <PriorityUnit>P</PriorityUnit>
        <CostUnit>USD</CostUnit>
    </PackageHeader>

    <RedefinableHeader PublicationStatus="UNDER_REVISION">
        <Author>Andy Zeneski</Author>
        <Version>1.4</Version>
        <Responsibles>
            <Responsible>admin</Responsible>
        </Responsibles>
    </RedefinableHeader>
    <ConformanceClass GraphConformance="FULL_BLOCKED"/>

    <Participants>
        <Participant Id="admin" Name="Workflow Admin">
            <ParticipantType Type="HUMAN"/>
            <Description>None</Description>
            <ExtendedAttributes>
                <ExtendedAttribute Name="partyId" Value="admin"/>
            </ExtendedAttributes>
        </Participant>

        <Participant Id="clerk" Name="Order Clerk">
            <ParticipantType Type="HUMAN"/>
            <Description>First handler of each order</Description>
            <ExtendedAttributes>
                <ExtendedAttribute Name="roleTypeId" Value="ORDER_CLERK"/>
            </ExtendedAttributes>
        </Participant>
        
        <Participant Id="user" Name="Dynamic User">
        	<ParticipantType Type="RESOURCE"/>
        	<Description>Dynamic user assignment</Description>
        	<ExtendedAttributes>
        		<ExtendedAttribute Name="partyId" Value="expr:partyId"/>
        	</ExtendedAttributes>
        </Participant>
    </Participants>
       
    <WorkflowProcesses>
        <WorkflowProcess Id="ProcessOrder" Name="Processes incoming orders">

            <ProcessHeader DurationUnit="m">
                <Created>2002-12-01 12:00:00</Created>
                <Description>Order Processing Workflow</Description>
                <Priority>5</Priority>
                <Limit>12</Limit>
                <ValidFrom>2002-12-01 12:00:00</ValidFrom>
                <ValidTo>2012-12-01 12:00:00</ValidTo>
                <TimeEstimation>
                    <WaitingTime>1</WaitingTime>
                    <WorkingTime>2</WorkingTime>
                    <Duration>3</Duration>
                </TimeEstimation>
            </ProcessHeader>
            
			<RedefinableHeader PublicationStatus="UNDER_REVISION">
        		<Author>OFBiz</Author>
	        	<Version>1.4</Version>
        		<Responsibles>
		          <Responsible>admin</Responsible>
        		</Responsibles>
			</RedefinableHeader>            

            <FormalParameters>
                <FormalParameter Id="orderId" Index="1" Mode="IN">
                    <DataType>
                        <BasicType Type="STRING"/>
                    </DataType>
                    <Description>The order number</Description>
                </FormalParameter>                                                
                <FormalParameter Id="orderStatusId" Index="2" Mode="INOUT">
                    <DataType>
                        <BasicType Type="STRING"/>
                    </DataType>
                    <Description>The order status</Description>
                </FormalParameter>              
            </FormalParameters>
            
            <DataFields>
            	<DataField Id="adminEmailList">
            		<DataType>
            			<BasicType Type="STRING"/>
            		</DataType>
            		<InitialValue>jaz@jflow.net,jonesde@ofbiz.org</InitialValue>
            	</DataField>
            </DataFields>

            <Activities>
                <Activity Id="receiveOrder" Name="Receive Order">
                    <Description>Initial activity when order is received</Description>
                    <Limit>1</Limit>
                    <Route/>
                    <Performer>admin</Performer>
                    <StartMode>
                        <Automatic/>
                    </StartMode>
                    <FinishMode>
                        <Automatic/>
                    </FinishMode>
                    <Priority>1</Priority>                    
                    <TransitionRestrictions>
                        <TransitionRestriction>
                            <Join Type="XOR"/>
                            <Split Type="XOR"/>
                        </TransitionRestriction>
                    </TransitionRestrictions>
                    <ExtendedAttributes>
                        <ExtendedAttribute Name="canStart" Value="Y"/>
                    </ExtendedAttributes>
                </Activity>
                
                <Activity Id="orderNotReady" Name="Order Not Ready">
                    <Description>The order is not ready for processing; suspend and wait for action</Description>
                    <Limit>72</Limit>
                    <Implementation>
                        <Tool Id="orderNotReadySuspend" Type="PROCEDURE">
                            <ActualParameters>                            	
                                <ActualParameter>workEffortId</ActualParameter>                                
                            </ActualParameters>   
                            <ExtendedAttributes>                            	                            	                                
                                <ExtendedAttribute Name="serviceName" Value="wfSuspendActivity"/>
                                <ExtendedAttribute Name="runAsUser" Value="admin"/>
                            </ExtendedAttributes>                                                     
                        </Tool>
                    </Implementation>
                    <Performer>admin</Performer>
                    <StartMode>
                        <Automatic/>
                    </StartMode>
                    <FinishMode>
                        <Automatic/>
                    </FinishMode>
                    <Priority>5</Priority>                    
                    <TransitionRestrictions>
                        <TransitionRestriction>
                            <Join Type="XOR"/>
                            <Split Type="XOR"/>
                        </TransitionRestriction>
                    </TransitionRestrictions>
                    <ExtendedAttributes>
                        <ExtendedAttribute Name="canStart" Value="N"/>
                        <ExtendedAttribute Name="runAsUser" Value="admin"/>
                        <ExtendedAttribute Name="limitAfterStart" Value="N"/>
                        <ExtendedAttribute Name="limitService" Value="sendProcessNotification"/>
                        <ExtendedAttribute Name="inheritPriority" Value="Y"/>
                    </ExtendedAttributes>
                </Activity>                
               
                <Activity Id="approveOrder" Name="Approve Order">
                    <Description>A clerk accepts and approves/declines the order</Description>
                    <Limit>12</Limit>
                    <Implementation>
                     	<No/>
                    </Implementation>
                    <Performer>clerk</Performer>
                    <StartMode>
                        <Manual/>
                    </StartMode>
                    <FinishMode>
                        <Manual/>
                    </FinishMode>
                    <Priority>5</Priority>                    
                    <TransitionRestrictions>
                        <TransitionRestriction>
                            <Join Type="XOR"/>
                            <Split Type="XOR"/>
                        </TransitionRestriction>
                    </TransitionRestrictions>
                    <ExtendedAttributes>
                        <ExtendedAttribute Name="canStart" Value="N"/>
                        <ExtendedAttribute Name="limitAfterStart" Value="N"/>
                        <ExtendedAttribute Name="limitService" Value="sendProcessNotification"/>                        
                        <ExtendedAttribute Name="inheritPriority" Value="Y"/>
                    </ExtendedAttributes>
                </Activity>
                
                <Activity Id="approveOrderEvent" Name="Approve Order Event">
                    <Description>Activity runs after an order is approved</Description>
                    <Limit>1</Limit>
                    <Implementation>
                    	<!-- change the order status -->
                        <Tool Id="completeOrderStatus" Type="PROCEDURE">
                            <ActualParameters>
                                <ActualParameter>orderId</ActualParameter>
                                <ActualParameter>statusId</ActualParameter>
                            </ActualParameters>
                            <ExtendedAttributes>                            	                            	
                                <ExtendedAttribute Name="statusId" Value="ORDER_APPROVED"/>
                                <ExtendedAttribute Name="serviceName" Value="changeOrderStatus"/>
                                <ExtendedAttribute Name="runAsUser" Value="admin"/>
                            </ExtendedAttributes>
                        </Tool>
                        <!-- email customer with the status change 
                        <Tool Id="emailOrderStatus" Type="PROCEDURE">
                            <ActualParameters>
                                <ActualParameter>orderId</ActualParameter>
                            </ActualParameters>
                        </Tool> -->                                    
                    </Implementation>
                    <Performer>admin</Performer>
                    <StartMode>
                        <Automatic/>
                    </StartMode>
                    <FinishMode>
                        <Automatic/>
                    </FinishMode>
                    <Priority>1</Priority>                    
                    <TransitionRestrictions>
                        <TransitionRestriction>
                            <Join Type="XOR"/>
                            <Split Type="XOR"/>
                        </TransitionRestriction>
                    </TransitionRestrictions>
                    <ExtendedAttributes>
                        <ExtendedAttribute Name="canStart" Value="N"/>
                    </ExtendedAttributes>
                </Activity>      
                          
                <Activity Id="rejectOrder" Name="Reject The Order">
                    <Description>Order was not appoved; reject the order</Description>
                    <Limit>1</Limit>
                    <Implementation>             
                        <!-- change the order status -->
                        <Tool Id="rejectOrderChangeOrderStatus" Type="PROCEDURE">
                        	<ActualParameters>                        		
                        		<ActualParameter>orderId</ActualParameter>
                        		<ActualParameter>statusId</ActualParameter>
                        	</ActualParameters>
                        	<ExtendedAttributes>                          		
                                <ExtendedAttribute Name="statusId" Value="ORDER_REJECTED"/>
                                <ExtendedAttribute Name="serviceName" Value="changeOrderStatus"/>                              
                                <ExtendedAttribute Name="runAsUser" Value="admin"/>
                            </ExtendedAttributes>
                        </Tool>
                        <Tool Id="rejectOrderChangeItemStatus" Type="PROCEDURE">
                        	<ActualParameters>                        		
                        		<ActualParameter>orderId</ActualParameter>
                        		<ActualParameter>statusId</ActualParameter>
                        	</ActualParameters>
                        	<ExtendedAttributes>                          		
                                <ExtendedAttribute Name="statusId" Value="ITEM_REJECTED"/>
                                <ExtendedAttribute Name="serviceName" Value="changeOrderItemStatus"/>                              
                                <ExtendedAttribute Name="runAsUser" Value="admin"/>
                            </ExtendedAttributes>
                        </Tool>                        
                        <!-- email customer with the status change 
                        <Tool Id="emailOrderStatus" Type="PROCEDURE">
                            <ActualParameters>
                                <ActualParameter>orderId</ActualParameter>
                            </ActualParameters>
                        </Tool> -->                                                                            
                    </Implementation>
                    <Performer>admin</Performer>
                    <StartMode>
                        <Automatic/>
                    </StartMode>
                    <FinishMode>
                        <Automatic/>
                    </FinishMode>
                    <Priority>5</Priority>                    
                    <TransitionRestrictions>
                        <TransitionRestriction>
                            <Join Type="XOR"/>
                            <Split Type="XOR"/>
                        </TransitionRestriction>
                    </TransitionRestrictions>
                    <ExtendedAttributes>
                        <ExtendedAttribute Name="canStart" Value="N"/>
                    </ExtendedAttributes>
                </Activity>
                
                <Activity Id="cancelOrder" Name="Cancel The Order">
                    <Description>Order has been cancelled; cancel the order and abort the workflow</Description>
                    <Limit>1</Limit>
                    <Implementation>             
                        <!-- change the order status -->
                        <Tool Id="suspendOrderChangeStatus" Type="PROCEDURE">
                        	<ActualParameters>                        		
                        		<ActualParameter>orderId</ActualParameter>
                        		<ActualParameter>statusId</ActualParameter>
                        	</ActualParameters>
                        	<ExtendedAttributes>                          		
                                <ExtendedAttribute Name="statusId" Value="ORDER_PROCESSING"/>
                                <ExtendedAttribute Name="serviceName" Value="changeOrderStatus"/>                              
                                <ExtendedAttribute Name="runAsUser" Value="admin"/>
                            </ExtendedAttributes>
                        </Tool>
                    	<!-- abort the current workflow -->
                        <Tool Id="suspendOrderCancelWorkflow" Type="PROCEDURE">
                            <ActualParameters>
                                <ActualParameter>workEffortId</ActualParameter>  
                            </ActualParameters>          
                        	<ExtendedAttributes>                          		                             
                                <ExtendedAttribute Name="serviceName" Value="wfCancelWorkflow"/>                              
                                <ExtendedAttribute Name="runAsUser" Value="admin"/>
                            </ExtendedAttributes>                                         
                        </Tool>  
                        <!-- email customer with the status change 
                        <Tool Id="emailOrderStatus" Type="PROCEDURE">
                            <ActualParameters>
                                <ActualParameter>orderId</ActualParameter>
                            </ActualParameters>
                        </Tool> -->                                                                            
                    </Implementation>
                    <Performer>admin</Performer>
                    <StartMode>
                        <Automatic/>
                    </StartMode>
                    <FinishMode>
                        <Automatic/>
                    </FinishMode>
                    <Priority>5</Priority>                    
                    <TransitionRestrictions>
                        <TransitionRestriction>
                            <Join Type="XOR"/>
                            <Split Type="XOR"/>
                        </TransitionRestriction>
                    </TransitionRestrictions>
                    <ExtendedAttributes>
                        <ExtendedAttribute Name="canStart" Value="N"/>
                    </ExtendedAttributes>
                </Activity>
                
                <Activity Id="completeOrder" Name="Complete Order">
                    <Description>A clerk accepts and completes (ships)/cancels the order</Description>
                    <Limit>12</Limit>
                    <Implementation>
                        <No/>
                    </Implementation>
                    <Performer>clerk</Performer>
                    <StartMode>
                        <Manual/>
                    </StartMode>
                    <FinishMode>
                        <Manual/>
                    </FinishMode>
                    <Priority>5</Priority>                    
                    <TransitionRestrictions>
                        <TransitionRestriction>
                            <Join Type="XOR"/>
                            <Split Type="XOR"/>
                        </TransitionRestriction>
                    </TransitionRestrictions>
                    <ExtendedAttributes>
                        <ExtendedAttribute Name="canStart" Value="N"/>
                        <ExtendedAttribute Name="limitAfterStart" Value="N"/>
                        <ExtendedAttribute Name="limitService" Value="sendProcessNotification"/>                       
                        <ExtendedAttribute Name="inheritPriority" Value="Y"/>
                    </ExtendedAttributes>
                </Activity>                
                                                          
                <Activity Id="completeOrderEvent" Name="Complete Order Event">
                    <Description>Activity runs after an order is completed</Description>
                    <Limit>1</Limit>
                    <Implementation>
                    	<!-- change the order status -->
                        <Tool Id="completeOrderStatus" Type="PROCEDURE">
                            <ActualParameters>
                                <ActualParameter>orderId</ActualParameter>
                                <ActualParameter>statusId</ActualParameter>
                            </ActualParameters>
                            <ExtendedAttributes>                            	                            	
                                <ExtendedAttribute Name="statusId" Value="ORDER_COMPLETED"/>
                                <ExtendedAttribute Name="serviceName" Value="changeOrderStatus"/>
                                <ExtendedAttribute Name="runAsUser" Value="admin"/>
                            </ExtendedAttributes>
                        </Tool>
                        <!-- email customer with the status change 
                        <Tool Id="emailOrderStatus" Type="PROCEDURE">
                            <ActualParameters>
                                <ActualParameter>orderId</ActualParameter>
                            </ActualParameters>
                        </Tool> -->              
                    </Implementation>
                    <Performer>admin</Performer>
                    <StartMode>
                        <Automatic/>
                    </StartMode>
                    <FinishMode>
                        <Automatic/>
                    </FinishMode>
                    <Priority>1</Priority>                    
                    <TransitionRestrictions>
                        <TransitionRestriction>
                            <Join Type="XOR"/>
                            <Split Type="XOR"/>
                        </TransitionRestriction>
                    </TransitionRestrictions>
                    <ExtendedAttributes>
                        <ExtendedAttribute Name="canStart" Value="N"/>
                    </ExtendedAttributes>
                </Activity>              
            </Activities>

            <Transitions>
                <Transition Id="trans1" From="receiveOrder" To="approveOrder" Loop="NOLOOP" Name="Goto Order Approve">
                    <Condition Type="CONDITION"><![CDATA[orderStatusId.equals("ORDER_PROCESSING")]]></Condition>                                     	                    
                </Transition>  
                <Transition Id="trans1.1" From="receiveOrder" To="completeOrder" Loop="NOLOOP" Name="Goto Order Complete">
                    <Condition Type="CONDITION"><![CDATA[orderStatusId.equals("ORDER_APPROVED")]]></Condition>                                                            	                    
                </Transition>
                <Transition Id="trans1.2" From="receiveOrder" To="orderNotReady" Loop="NOLOOP" Name="Order not ready for processing">
                    <Condition Type="OTHERWISE"/>                     
                </Transition>                                  
                                                                                                           
                <Transition Id="trans2" From="approveOrder" To="cancelOrder" Loop="NOLOOP" Name="Cancel Order">
                    <Condition Type="CONDITION"><![CDATA[approvalCode.equals("0")]]></Condition>        
                    <!-- Extended Attributes are not used by the engine; this is for client application reference -->
                    <ExtendedAttributes>
                    	<ExtendedAttribute Name="approvalCode" Value="0"/>
                    </ExtendedAttributes>                                    
                </Transition>
                <Transition Id="trans2.1" From="approveOrder" To="rejectOrder" Loop="NOLOOP" Name="Reject Order">
                    <Condition Type="CONDITION"><![CDATA[approvalCode.equals("1")]]></Condition>
                    <!-- Extended Attributes are not used by the engine; this is for client application reference -->
                    <ExtendedAttributes>
                    	<ExtendedAttribute Name="approvalCode" Value="1"/>
                    </ExtendedAttributes>                                            
                </Transition>                   
                <Transition Id="trans2.2" From="approveOrder" To="approveOrderEvent" Loop="NOLOOP" Name="Approve Order">
                    <Condition Type="CONDITION"><![CDATA[approvalCode.equals("2")]]></Condition>
                    <!-- Extended Attributes are not used by the engine; this is for client application reference -->
                    <ExtendedAttributes>
                    	<ExtendedAttribute Name="approvalCode" Value="2"/>
                    </ExtendedAttributes>                                            
                </Transition>   

                <Transition Id="trans3" From="approveOrderEvent" To="completeOrder" Loop="NOLOOP" Name="Complete Order">
                    <Condition Type="OTHERWISE"/>
                </Transition>    
                                
                <Transition Id="trans4" From="completeOrder" To="cancelOrder" Loop="NOLOOP" Name="Cancel Order">
                    <Condition Type="CONDITION"><![CDATA[approvalCode.equals("0")]]></Condition>        
                     <!-- Extended Attributes are not used by the engine; this is for client application reference -->
                    <ExtendedAttributes>
                    	<ExtendedAttribute Name="approvalCode" Value="0"/>
                    </ExtendedAttributes>                                                     
                </Transition>                             
                <Transition Id="trans4.1" From="completeOrder" To="completeOrderEvent" Loop="NOLOOP" Name="Complete Order">
                    <Condition Type="CONDITION"><![CDATA[approvalCode.equals("2")]]></Condition>        
                     <!-- Extended Attributes are not used by the engine; this is for client application reference -->
                    <ExtendedAttributes>
                    	<ExtendedAttribute Name="approvalCode" Value="3"/>
                    </ExtendedAttributes>                                                                         
                </Transition> 
                
                <Transition Id="trans5" From="orderNotReady" To="approveOrder" Loop="NOLOOP" Name="Goto Order Approve">
                    <Condition Type="CONDITION"><![CDATA[orderStatusId.equals("ORDER_PROCESSING")]]></Condition>                                                            	                    
                </Transition>  
                <Transition Id="trans5.1" From="orderNotReady" To="completeOrder" Loop="NOLOOP" Name="Goto Order Complete">
                    <Condition Type="CONDITION"><![CDATA[orderStatusId.equals("ORDER_APPROVED")]]></Condition>                                                            	                    
                </Transition>
                <Transition Id="trans5.2" From="orderNotReady" To="receiveOrder" Loop="NOLOOP" Name="Order not ready for processing">
                    <Condition Type="OTHERWISE"/>                     
                </Transition>                                                                    
            </Transitions>
            
            <ExtendedAttributes>            	
            	<ExtendedAttribute Name="sourceReferenceField" Value="orderId"/>            
            </ExtendedAttributes>
        </WorkflowProcess>

    </WorkflowProcesses>

</Package>
