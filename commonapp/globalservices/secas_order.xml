<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE service-eca PUBLIC "-//OFBiz//DTD Service ECA Config//EN" "http://www.ofbiz.org/dtds/service-eca.dtd">

<service-eca>
    <eca service="changeOrderItemStatus" event="commit">
        <condition field-name="statusId" operator="equals" value="ITEM_CANCELLED"/>
        <action service="resetGrandTotal" mode="sync"/>
    </eca>
    <eca service="changeOrderStatus" event="invoke" run-on-error="false">
        <condition field-name="statusId" operator="equals" value="ORDER_COMPLETED"/>        
        <action service="captureOrderPayments" mode="sync"/>
    </eca>
    <eca service="changeOrderStatus" event="commit" run-on-error="false">
        <condition field-name="statusId" operator="equals" value="ORDER_COMPLETED"/>        
        <action service="createInvoiceFromOrder" mode="async" persist="true"/>
    </eca>
    <eca service="createOrderAdjustment" event="commit">        
        <action service="resetGrandTotal" mode="sync"/>
    </eca>  

    <!-- ShoppingList ECAs --> 
    <eca service="createShoppingListItem" event="in-validate">
        <condition field-name="shoppingListId" operator="is-empty"/>
        <action service="createShoppingList" mode="sync" result-to-context="true"/>
    </eca>
    
    <!-- Requirement / CustRequestItem association event -->
    <eca service="createRequirement" event="commit">
    	<condition field-name="custRequestId" operator="is-not-empty"/>
    	<condition field-name="custRequestItemSeqId" operator="is-not-empty"/>
    	<action service="associatedRequirementWithRequestItem" mode="sync"/>
    </eca>
</service-eca>
