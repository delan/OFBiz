<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE service-eca PUBLIC "-//OFBiz//DTD Service ECA Config//EN" "http://www.ofbiz.org/dtds/service-eca.dtd">

<service-eca>
    <!-- Inventory Transfer ECAs -->
    <eca service="createInventoryTransfer" event="invoke">  
    	<condition field-name="statusId" operator="not-equals" value="IXF_CANCELLED"/>  	
        <action service="prepareInventoryTransfer" mode="sync"/>
    </eca>
    <eca service="createInventoryTransfer" event="commit">
    	<condition field-name="statusId" operator="equals" value="IXF_COMPLETE"/>
    	<action service="completeInventoryTransfer" mode="sync"/>
    </eca>
    
    <eca service="updateInventoryTransfer" event="invoke">
    	<condition field-name="statusId" operator="equals" value="IXF_CANCELLED"/>
    	<action service="cancelInventoryTransfer" mode="sync"/>
    </eca>
    <eca service="updateInventoryTransfer" event="commit">
    	<condition field-name="statusId" operator="equals" value="IXF_COMPLETE"/>
        <action service="completeInventoryTransfer" mode="sync"/>
    </eca>

    <!-- Inventory Issue ECAs for Immediately Fulfilled Orders -->
    <eca service="changeOrderStatus" event="commit" run-on-error="false">
        <condition field-name="statusId" operator="equals" value="ORDER_COMPLETED"/>
        <condition field-name="orderStatusId" operator="not-equals" value="ORDER_COMPLETED"/>
        <condition field-name="needsInventoryIssuance" operator="is-not-empty"/>
        <condition field-name="needsInventoryIssuance" operator="equals" value="Y"/>
        <action service="issueImmediatelyFulfilledOrder" mode="sync"/>
    </eca>

    <!-- Product Price Change ECAs -->
    <eca service="createProductPrice" event="commit">
        <action service="saveProductPriceChange" mode="sync"/>
    </eca>
    <eca service="updateProductPrice" event="commit">
    	<condition-field field-name="price" operator="not-equals" to-field-name="oldPrice" type="Double"/>
        <action service="saveProductPriceChange" mode="sync"/>
    </eca>
    <eca service="deleteProductPrice" event="commit">
        <action service="saveProductPriceChange" mode="sync"/>
    </eca>

    <!-- Product Party ECAs -->
    <eca service="addPartyToCategory" event="invoke">
    	<condition field-name="roleTypeId" operator="equals" value="_NA_"/>
        <action service="ensureNaPartyRole" mode="sync"/>
    </eca>
    <eca service="addPartyToFacility" event="invoke">
    	<condition field-name="roleTypeId" operator="equals" value="_NA_"/>
        <action service="ensureNaPartyRole" mode="sync"/>
    </eca>
    <eca service="addPartyToFacilityGroup" event="invoke">
    	<condition field-name="roleTypeId" operator="equals" value="_NA_"/>
        <action service="ensureNaPartyRole" mode="sync"/>
    </eca>
    <eca service="addProdCatalogToParty" event="invoke">
    	<condition field-name="roleTypeId" operator="equals" value="_NA_"/>
        <action service="ensureNaPartyRole" mode="sync"/>
    </eca>

    <!-- Product Content ECAs -->
    <eca service="createProductContent" event="in-validate">
    	<condition field-name="contentId" operator="is-empty"/>
        <action service="createContent" mode="sync"/>
    </eca>
</service-eca>
