<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE entity-eca PUBLIC "-//OFBiz//DTD Entity ECA Config//EN" "http://www.ofbiz.org/dtds/entity-eca.dtd">

<entity-eca>
    <!-- Product Keyword Indexing ECAs -->
    <eca entity="Product" operation="create-store" event="return">
        <condition field-name="autoCreateKeywords" operator="not-equals" value="N"/>
        <action service="indexProductKeywords" mode="sync" value-attr="productInstance"/>
    </eca>
    <eca entity="ProductAttribute" operation="create-store" event="return">
        <action service="indexProductKeywords" mode="sync"/>
    </eca>
    <eca entity="ProductFeatureAppl" operation="create-store" event="return">
        <action service="indexProductKeywords" mode="sync"/>
    </eca>
    <eca entity="ProductContent" operation="create-store" event="return">
        <action service="indexProductKeywords" mode="sync"/>
    </eca>

    <eca entity="InventoryItem" operation="create-store" event="return">
        <condition field-name="productId" operator="is-not-empty"/>
        <condition field-name="availableToPromiseTotal" operator="is-not-empty"/>
        <condition field-name="availableToPromiseTotal" operator="less-equals" value="0" type="Double"/>
        <action service="checkProductInventoryDiscontinuation" mode="async"/>
    </eca>
    <!-- Just in case an InventoryItem is ever created with ATP/QOH values, catch and handle that -->
    <eca entity="InventoryItem" operation="create" event="return">
        <action service="createInventoryItemCheckSetAtpQoh" mode="sync"/>
    </eca>
    <!-- The InventoryItemDetail entity should never be updated/stored or deleted/removed, but we'll catch those too anyway... -->
    <eca entity="InventoryItemDetail" operation="create-store-remove" event="return">
        <action service="updateInventoryItemFromDetail" mode="sync"/>
    </eca>
    
    <!-- Inventory Issue ECAs for Immediately Fulfilled Orders -->
    <!--
    <eca entity="OrderHeader" operation="create-store" event="return">
        <condition field-name="statusId" operator="equals" value="ORDER_COMPLETED"/>
        <condition field-name="needsInventoryIssuance" operator="equals" value="Y"/>
        <action service="issueImmediatelyFulfilledOrder" mode="sync"/>
    </eca>
    -->
</entity-eca>
