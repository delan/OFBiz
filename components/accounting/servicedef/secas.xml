<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE service-eca PUBLIC "-//OFBiz//DTD Service ECA Config//EN" "http://www.ofbiz.org/dtds/service-eca.dtd">

<service-eca>
    <eca service="createInvoiceForOrder" event="return">
        <condition field-name="invoiceId" operator="is-not-empty"/>
        <action service="capturePaymentsByInvoice" mode="sync"/>
    </eca>        
    <eca service="createPaymentApplication" event="commit">
        <action service="checkInvoicePaymentApplications" mode="sync"/>
    </eca>
    <eca service="createPartyPostalAddress" event="commit">
        <condition field-name="paymentMethodId" operator="is-not-empty"/>
        <action service="setPaymentMethodAddress" mode="sync"/>
    </eca>
    <!-- do the updatePostalAddress before the return and after the commit so it can use its own transaction and not effect the updating of the PostalAddress -->
    <eca service="updatePostalAddress" event="return">
        <action service="updatePaymentMethodAddress" mode="sync"/>
    </eca>

    <eca service="createCreditCard" event="in-validate">
        <condition field-name="expMonth" operator="is-not-empty"/>
        <condition field-name="expYear" operator="is-not-empty"/>
        <action service="buildCcExpireDate" mode="sync"/>
    </eca>
    <eca service="updateCreditCard" event="in-validate">
        <condition field-name="expMonth" operator="is-not-empty"/>
        <condition field-name="expYear" operator="is-not-empty"/>
        <action service="buildCcExpireDate" mode="sync"/>
    </eca>

    <eca service="createCreditCardAndAddress" event="in-validate">
        <condition field-name="expMonth" operator="is-not-empty"/>
        <condition field-name="expYear" operator="is-not-empty"/>
        <action service="buildCcExpireDate" mode="sync"/>
    </eca>
    <eca service="updateCreditCardAndAddress" event="in-validate">
        <condition field-name="expMonth" operator="is-not-empty"/>
        <condition field-name="expYear" operator="is-not-empty"/>
        <action service="buildCcExpireDate" mode="sync"/>
    </eca>

    <eca service="createGiftCard" event="in-validate">
        <condition field-name="expMonth" operator="is-not-empty"/>
        <condition field-name="expYear" operator="is-not-empty"/>
        <action service="buildCcExpireDate" mode="sync"/>
    </eca>
    <eca service="updateGiftCard" event="in-validate">
        <condition field-name="expMonth" operator="is-not-empty"/>
        <condition field-name="expYear" operator="is-not-empty"/>
        <action service="buildCcExpireDate" mode="sync"/>
    </eca>

    <eca service="authOrderPayments" event="global-rollback">
        <action service="releaseOrderPayments" mode="sync"/>
    </eca>
</service-eca>
