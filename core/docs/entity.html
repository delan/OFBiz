<html>
<head>
<title>Open For Business Entity Engine</title>
      <title>Postal Address Entity</title>
      <package-name>
</head>

<body>

<h2 align="center">The Open For Business Project: Entity Engine</h2>

<br>Written By: David E. Jones
<br>Email: <a href="mailto:jonesde@ofbiz.org">jonesde@ofbiz.org</a>
<br>Open For Business Site: <a href="http://www.ofbiz.org/">http://www.ofbiz.org</a>
<br><A href="http://sf.net/projects/ofbiz"> <IMG src="http://sourceforge.net/sflogo.php?group_id=27173" border="0" alt="SourceForge Logo"></A>
<br>Last Updated: August 20, 2001

<h3>Table of Contents</h3>

<ul>
	<li><a href="#Related Documents">Related Documents</a>
	<li><a href="#Introduction">Introduction</a>
	<li><a href="#Entity Modeling">Entity Modeling</a>
	<li><a href="#The Generic Entity">The Generic Entity</a>
	<li><a href="#CommonApp Tools">CommonApp Tools</a>
</ul>

<hr>

<h3><a name="Related Documents">Related Documents:</a></h3>
<hr>
<ul>
  <li><a href="javadoc/index.html">Core JavaDoc (including Entity Engine)</a></li>
  <li><a href="entitymodel.dtd">Entity Engine Entity Model DTD</a></li>
  <li><a href="fieldtypemodel.dtd">Entity Engine Field Type Model DTD</a></li>
</ul>

<hr>
<h3><a name="Introduction">Introduction</a></h3>
<hr>
<p>The Open For Business Entity Engine is a set of tools and patterns used to
model and manage entity specific data. In this context an entity is a piece of
data defined by a set of fields and a set of relations to other entities. This
definition comes from the standard Entity-Relation modeling concepts of
Relational Database Management Systems. The goal of the entity engine is to
simplify the enterprise wide use of entity data. This includes definition,
maintenance, quality assurance, and development of entity related functionality.</p>
<p>Using the Entity Engine as an abstraction layer entity specific code can be
easily created and modified. Code that uses the Entity Engine APIs to interact
with entities can be deployed in various ways so that entity persistence can be
done differently without changing the code that interacts with those entities on
a higher level. An example of the usefulness of this abstraction is that by
changing a configuration file and application written using the Entity Engine
can switch from hitting a database directly through JDBC to using an EJB server
and Entitiy Beans for persistence. The same code could also be used for custom
data sources like legacy systems through a bit of custom coding within the same
framework.</p>
<p>The basic tools in the package can be divided into three interacting
packages. The first is the package used to define entity models. The second is
the Generic Entity which is a set of Java code used to implement persistence and
other entity management features. The third is the Web-based Tool Set in the
CommonApp module.</p>
<p>The configuration of the Entity Engine is done through a simple properties
file called servers.properties that must exist somewhere on the classpath. This
properties file is used to define parameters for persistence servers such as EJB
server parameters of JDBC server parameters. It is also used to specify which
XML entity and field type model files will be used for that server. A default
server name and server type (ejb or jdbc) can also be specified. When an
instance of the GenericHelper is created, it must know the name of the server
that is will be using and it will use that server name and the server type to
look up details about that server in the servers.properties file. An example of
this file can be found in <b>ofbiz/commonapp/conf/servers.properties</b>.</p>

<hr>
<h3><a name="Entity Modeling">Entity Modeling</a></h3>
<hr>
<p>The first thing to do when starting work with a new entity is to define or
model that entity. In the ofbiz Entity Engine this is done through two XML
files, one for entity modeling and the other for field type modeling. There are
links to the XML DTDs for these documents in the <a href="#Related Documents">Related
Documents</a> section above. The reason that these two files are separated is
that field type definitions can be database specific. In other words, for a
given entity model definition various field type definitions may exist for
different databases. When a persistence server is defined the field type model
XML file to be used for that server is specified.</p>
<p>The main entity model XML file for Open For Business can be found in <b>ofbiz/commonapp/entitydef/entitymodel.xml</b>.
The main field type model XML file for Open For Business can be found in <b>ofbiz/commonapp/entitydef/fieldtypemodel.xml</b>.
From these two files the SQL code used to define tables and populate security
settings for the entities can be automatically generated through the tools in
commonapp. In addition to these generated SQL scripts there are two others that
must be run for commonapp. The first is <b>ofbiz/commonapp/db/commonapp-data-mysql.sql</b>
and it contains sample data and administration accounts for commonapp, and can
be used to get other applications started as well. The second is <b>ofbiz/commonapp/db/datamodel-data.sql</b>
which has all of the entity type definitions which correspond to the entities
definted in entitymodel.xml. When I say entity type definitions, I am referring
to the entity types used in the entity extensibility pattern defined in the
Entity Overview document on the ofbiz website.</p>
<p>As mentioned above an entity consists of a set of fields and a set of
relations to other entities. In the XML entity definitions each of these things
is specified in addition to attributes of the entity itself such as the entity
name, the corresponding table name, the package name for the entity, and meta
data about the entity such as the author, a copyright notice, a description, and
so forth. Here is an example of an XML entity definition:</p>

<pre>    &lt;entity&gt;
      &lt;title&gt;Sample Entity&lt;/title&gt;
      &lt;copyright&gt;Copyright (c) 2001 John Doe Enterprises&lt;/copyright&gt;
      &lt;author&gt;John Doe&lt;/author&gt;
      &lt;version&gt;1.0&lt;/version&gt;
      &lt;package-name&gt;org.ofbiz.commonapp.sample&lt;/package-name&gt;
      &lt;entity-name&gt;SampleEntity&lt;/entity-name&gt;
      &lt;table-name&gt;SAMPLE_ENTITY&lt;/table-name&gt;
      &lt;field&gt;&lt;name&gt;primaryKeyFieldOne&lt;/name&gt;&lt;col-name&gt;PRIMARY_KEY_FIELD_ONE&lt;/col-name&gt;&lt;type&gt;id-ne&lt;/type&gt;&lt;/field&gt;
      &lt;field&gt;&lt;col-name&gt;PRIMARY_KEY_FIELD_TWO&lt;/col-name&gt;&lt;type&gt;id-ne&lt;/type&gt;&lt;/field&gt;
      &lt;field&gt;&lt;col-name&gt;FIELD_ONE&lt;/col-name&gt;&lt;type&gt;long-varchar&lt;/type&gt;&lt;/field&gt;
      &lt;field&gt;&lt;col-name&gt;FIELD_TWO&lt;/col-name&gt;&lt;type&gt;long-varchar&lt;/type&gt;&lt;/field&gt;
      &lt;field&gt;&lt;col-name&gt;FOREIGN_KEY_ONE&lt;/col-name&gt;&lt;type&gt;id&lt;/type&gt;&lt;/field&gt;
      &lt;prim-key-col&gt;PRIMARY_KEY_FIELD_ONE&lt;/prim-key-col&gt;
      &lt;prim-key-col&gt;PRIMARY_KEY_FIELD_TWO&lt;/prim-key-col&gt;
      &lt;relation&gt;
        &lt;type&gt;one&lt;/type&gt;&lt;rel-table-name&gt;OTHER_SAMPLE_ENTITY&lt;/rel-table-name&gt;
        &lt;key-map&gt;&lt;col-name&gt;FOREIGN_KEY_ONE&lt;/col-name&gt;&lt;rel-col-name&gt;PRIMARY_KEY_ONE&lt;/rel-col-name&gt;&lt;/key-map&gt;
      &lt;/relation&gt;
      &lt;relation&gt;
        &lt;type&gt;one&lt;/type&gt;&lt;title&gt;Self&lt;/title&gt;&lt;rel-table-name&gt;SAMPLE_ENTITY&lt;/rel-table-name&gt;
        &lt;key-map&gt;&lt;col-name&gt;PRIMARY_KEY_FIELD_ONE&lt;/col-name&gt;&lt;/key-map&gt;
        &lt;key-map&gt;&lt;col-name&gt;PRIMARY_KEY_FIELD_TWO&lt;/col-name&gt;&lt;/key-map&gt;
      &lt;/relation&gt;
      &lt;relation&gt;
        &lt;type&gt;many&lt;/type&gt;&lt;title&gt;AllOne&lt;/title&gt;&lt;rel-table-name&gt;SAMPLE_ENTITY&lt;/rel-table-name&gt;
        &lt;key-map&gt;&lt;col-name&gt;PRIMARY_KEY_FIELD_ONE&lt;/col-name&gt;&lt;/key-map&gt;
      &lt;/relation&gt;
    &lt;/entity&gt;</pre>

<p>This is a pretty simple entity that demonstrates a few small points. The meta
data at the top is all optional, and if left unspecified will default to meta
data defined for the entire entity model file. For example the description
element was left out, so the ModelReader will use the description specified at
the top of the XML file if one exists. The package-name is used to organize the
entities, and specify a default location for any code that would be entity
specific. This becomes extremely useful when you have an entity model with
hundreds of entities.</p>

<p> Notice
that while the field primaryKeyFieldOne has a name specified, none of the other
fields do. The field.name, and the entity-name, elements are optional. They can
be derived from the column name or table name through widely used conventions.
These conventions dramatically simplify the definition of entities. Table and
column names are written in caps with underscores separating the words like
SAMPLE_ENTITY. Entity and field names are written using the Java conventions for
class and field names where all letters are lowercase except for the first
letter of each word, which is uppercase. Entity names correspond to Java classes
to the first letter is upper case but field names correspond to member fields of
a class so the first letter is lower case. For example: SampleEntity and
fieldOne correspond to SAMPLE_ENTITY and FIELD_ONE.</p>
<p>Multiple primary key columns can be specified using multiple &lt;prim-key-col&gt;
tags specifying the names of the primary key columns.</p>
<p>Field types are specified using a type string, which is defined in a
fieldtypemodel XML file specified by the fieldtypemodel.dtd XML Data Type
Definition. Each type maps to a Java type and an SQL type. Because of this
separation different fieldtypemodel XML files can be specified for different
databases allowing an entitymodel XML file to work with the various databases.
In addition, validators can be specified for a field type or for any field which
denote that the named validator should be called when data is input. These
validators are defined in the class <b>org.ofbiz.core.util.UtilValidate</b> and
follow the definition pattern: [<code>boolean isValid(String in);</code>].</p>
<p>Multiple relations can exist for each entity. Each relation is either of type
'one' or of type 'many' depending on the cardinality of the relation. If the
type is 'one' then the key-map elements must fully specifiy the primary key of
the related entity. If the type is many, the key-map elements do not need to
have any relation to the primary key of the related entity. If multiple
relations to the same related entity are used for a given entity, a title must
be specified to make the relation name unique. By this convention the relation
name is defined as [title][rel-table-name]. For the two SAMPLE_ENTITY relations
their names are SelfSampleEntity and AllOneSampleEntity. For OTHER_SAMPLE_ENTITY
there is no title, so the relation name is simply OtherSampleEntity, or the name
of the related entity.</p>
<p>Key Maps are used to define how the related entity will be looked up. Each
key map specified a column name (col-name) and a related column name (rel-col-name).
If the two column names are the same, the rel-col-name does not have to be
specified.</p>

<hr>
<h3><a name="The Generic Entity">The Generic Entity</a></h3>
<hr>
<p>The Generic Entity classes in the package org.ofbiz.core.entity define the
API used to interact with Entity Engine entity data. From a users point of view
only three classes really need to be understood. They are GenericHelper,
GenericValue and GenericPK. The GenericHelper class, usually used as just
'helper', is used to do create, find, store and other operations on a
GenericValue object. Once a GenericValue object is created it will contain a
reference to the helper that created it and through this reference it knows how
to store and remove itself.</p>

<hr>
<h3><a name="CommonApp Tools">CommonApp Tools</a></h3>
<hr>

<p>&nbsp;</p>

</body>

</html>
